import validators
from urlparse import urlparse, parse_qs
from malware_url_lookup_db import is_url_malware


class malware_url_lookup_service:

    def __init__(self, url):
        self.url = url

    def validate(self):
        """
        Validate whether the given URL is in a valid format - http://domain.tld
        """
        url_valid = False
        try:
            url_valid = validators.url(self.url)
        except:
            print "Enter a valid URL in the format http://domain.tld"
            raise

	# Extract domain.tld from the URL to match against the DB entries
        # This is to ensure that https://www.abcd.com is treated the same as www.abcd.com
        if url_valid:
            url_db = urlparse(self.url).netloc
        else:
            print "URL is not valid."

        # Connect to db and search whether the url  is in the list of malwares
        return is_url_malware(url_db)
